from ...client import client



 
import pymetasploit3.msfrpc

class SearchMixin(pymetasploit3.msfrpc.MsfModule):

    @classmethod
    def search(cls, text=None, port=None, ignore_if_options=(
        'DATABASE',
        'PASSWORD',
        'USERNAME',
    )):
        """
        Returns a generator of tools that match the given filter parameters.

        :param text: Text to search for.
        :param port: Port to search for.

        :param ignore_if_options: List of options to ignore. I.E Ignore modules requiring DATABASE or PASSWORD.
        """

        _search_arr = []
        if text:
            _search_arr.append((text))
        if port:
            _search_arr.append("port:{}".format(port))

        for module in client.call("module.search", _search_arr):
            yieldable =  cls(module["fullname"])
            if not any(option in yieldable.options for option in ignore_if_options):
                yield yieldable
            
